apiVersion: batch/v1
kind: Job
metadata:
  name: bq-indexer
spec:
  template:
    metadata:
      name: bq-indexer
    spec:
      containers:
      - name: bq-indexer
        image: gcr.io/melchang-test-project-2/bq-indexer
        # Uncomment to force repulling image. This is useful if you're modifying
        # indexer.py and want to test on GKE.
        # imagePullPolicy: Always
        volumeMounts:
        - name: dataset-config
          mountPath: /app/dataset_config
        command: ["python", "/app/indexer.py"]
        args: [
          "--elasticsearch_url", "http://10.128.0.7:9200/",
          # Note: This is different from local deployment. With local
          # deployment, this ends in MY_DATASET (dataset_config/MY_DATASET).
          "--dataset_config_dir", "/app/dataset_config",
          "--billing_project_id", "melchang-test-project-2"
        ]

      restartPolicy: Never

      volumes:
      - name: dataset-config
        configMap:
          name: dataset-config
